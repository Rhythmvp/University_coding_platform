<%- include('partials/head') %>
<%- include('partials/header') %>

<!-- Assessment Section -->
<section class="assessment-section py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title text-center mb-5">
                    <h2 class="fw-bold">Available Assessments</h2>
                    <p class="text-muted">Test your knowledge with our interactive assessments</p>
                </div>
            </div>
        </div>

        <div class="row" id="assessments-container">
            <!-- Assessments will be loaded here -->
            <div class="col-12 text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Assessment Card Template -->
<template id="assessment-card-template">
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card assessment-card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="card-title mb-0"></h5>
                    <span class="badge bg-primary"></span>
                </div>
                <p class="card-text text-muted"></p>
                <div class="assessment-meta mb-3">
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        <span class="time-limit"></span> minutes
                    </small>
                    <br>
                    <small class="text-muted">
                        <i class="fas fa-question-circle me-1"></i>
                        <span class="question-count"></span> questions
                    </small>
                </div>
                <button class="btn btn-primary w-100 start-assessment-btn">
                    Start Assessment
                </button>
            </div>
        </div>
    </div>
</template>

<!-- No Assessments Template -->
<template id="no-assessments-template">
    <div class="col-12 text-center">
        <div class="empty-state">
            <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No Assessments Available</h4>
            <p class="text-muted">Check back later for new assessments.</p>
        </div>
    </div>
</template>

<style>
.assessment-card {
    transition: transform 0.2s ease-in-out;
    border: none;
    border-radius: 15px;
}

.assessment-card:hover {
    transform: translateY(-5px);
}

.assessment-card .card-body {
    padding: 1.5rem;
}

.assessment-meta {
    border-top: 1px solid #eee;
    padding-top: 1rem;
}

.empty-state {
    padding: 3rem 0;
}

.badge {
    font-size: 0.75rem;
}

.badge.bg-primary {
    background-color: #007bff !important;
}

.badge.bg-success {
    background-color: #28a745 !important;
}

.badge.bg-warning {
    background-color: #ffc107 !important;
    color: #212529;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadAssessments();
});

async function loadAssessments() {
    try {
        const response = await fetch('/api/assessments');
        const assessments = await response.json();
        
        const container = document.getElementById('assessments-container');
        container.innerHTML = '';
        
        if (assessments.length === 0) {
            const template = document.getElementById('no-assessments-template');
            const clone = template.content.cloneNode(true);
            container.appendChild(clone);
            return;
        }
        
        assessments.forEach(assessment => {
            const card = createAssessmentCard(assessment);
            container.appendChild(card);
        });
    } catch (error) {
        console.error('Error loading assessments:', error);
        document.getElementById('assessments-container').innerHTML = 
            '<div class="col-12 text-center"><p class="text-danger">Error loading assessments. Please try again.</p></div>';
    }
}

function createAssessmentCard(assessment) {
    const template = document.getElementById('assessment-card-template');
    const clone = template.content.cloneNode(true);
    
    const card = clone.querySelector('.assessment-card');
    const title = clone.querySelector('.card-title');
    const description = clone.querySelector('.card-text');
    const badge = clone.querySelector('.badge');
    const timeLimit = clone.querySelector('.time-limit');
    const questionCount = clone.querySelector('.question-count');
    const startBtn = clone.querySelector('.start-assessment-btn');
    
    title.textContent = assessment.title;
    description.textContent = assessment.description;
    badge.textContent = assessment.type.toUpperCase();
    badge.className = `badge ${assessment.type === 'mcq' ? 'bg-primary' : 'bg-success'}`;
    timeLimit.textContent = assessment.timeLimit || 60;
    
    const totalQuestions = (assessment.questions ? assessment.questions.length : 0) + 
                          (assessment.codingQuestions ? assessment.codingQuestions.length : 0);
    questionCount.textContent = totalQuestions;
    
    startBtn.addEventListener('click', () => {
        window.location.href = `/assessment/${assessment._id}`;
    });
    
    return clone;
}
</script>

<%- include('partials/footer') %> 